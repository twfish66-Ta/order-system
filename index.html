<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>點餐計價系統</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Chart.js 圖表庫 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* 使用 Google 字體 Inter 和 Noto Sans TC */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+TC:wght@400;500;700&display=swap');
        html {
            scroll-behavior: smooth; /* 讓頁面滾動更平滑 */
        }
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        /* 按鈕點擊時的動畫效果 */
        .btn-press {
            transform: scale(0.95);
            transition: transform 0.1s ease-in-out;
        }
        /* 項目被選中時的樣式 */
        .item-selected {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
            background-color: #EBF8FF;
        }
        /* 禁用按鈕的樣式 */
        .disabled-btn {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: #9CA3AF; /* 更明顯的禁用顏色 */
        }
    </style>
</head>
<body class="bg-gray-100 p-2 sm:p-4">

    <!-- 主容器 -->
    <div class="w-full max-w-4xl mx-auto bg-white rounded-2xl shadow-lg p-3 md:p-6 mb-8">
        
        <!-- 主內容區塊 -->
        <div class="w-full pt-6">
            <!-- 商品列表容器 (Grid 佈局) -->
            <div id="items-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2">
                <!-- 菜單項目與重設按鈕將會被插入到這裡 -->
            </div>

            <!-- 控制區塊 -->
            <div class="mt-6">
                <!-- 總金額方格 -->
                <div class="bg-blue-600 text-white p-4 rounded-lg w-full flex items-center justify-between shadow-lg">
                    <h2 class="text-lg font-semibold">總金額</h2>
                    <span id="total-price" class="text-2xl font-bold">NT$ 0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 訂單記錄區塊 -->
    <div id="order-log-section" class="w-full max-w-4xl mx-auto bg-white rounded-2xl shadow-lg p-3 md:p-6 mb-8">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl md:text-2xl font-bold text-gray-800">訂單記錄</h2>
            <button id="clear-log-btn" class="bg-red-500 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-red-600 transition-all">
                全部清除
            </button>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full bg-white border border-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">訂單編號</th>
                        <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">品項</th>
                        <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">總金額</th>
                        <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">時間</th>
                    </tr>
                </thead>
                <tbody id="order-log-body">
                    <!-- 訂單記錄將會被插入到這裡 -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- 商品銷售總表 -->
    <div id="summary-section" class="w-full max-w-4xl mx-auto bg-white rounded-2xl shadow-lg p-3 md:p-6 mb-8">
        <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">商品銷售總表</h2>
        <div class="overflow-x-auto">
            <table class="min-w-full bg-white border border-gray-200" id="sales-summary-table">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">商品</th>
                        <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">總數量</th>
                        <th class="py-2 px-4 border-b text-left text-sm font-semibold text-gray-600">總金額 (NT$)</th>
                    </tr>
                </thead>
                <tbody id="sales-summary-body">
                    <!-- 銷售總結將會被插入到這裡 -->
                </tbody>
                <tfoot id="sales-summary-footer">
                    <!-- 當日總金額將會被插入到這裡 -->
                </tfoot>
            </table>
        </div>
    </div>

    <!-- 統計圖表區塊 -->
    <div id="charts-section" class="w-full max-w-4xl mx-auto bg-white rounded-2xl shadow-lg p-3 md:p-6">
        <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">銷售統計圖表</h2>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div>
                <h3 class="text-lg font-semibold text-center text-gray-700 mb-2">商品銷售數量</h3>
                <canvas id="quantityChart"></canvas>
            </div>
            <div>
                <h3 class="text-lg font-semibold text-center text-gray-700 mb-2">商品銷售金額 (NT$)</h3>
                <canvas id="revenueChart"></canvas>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            // --- 資料定義 ---
            const menuItems = [
                { id: 2, name: '蛋絲、火腿涼麵', price: 70, emoji: '🍜' },
                { id: 3, name: '燻雞涼麵', price: 80, emoji: '🍜' },
                { id: 4, name: '松坂肉涼麵', price: 90, emoji: '🍜' },
                { id: 5, name: '燒肉刈包', price: 85, emoji: '🍔' },
                { id: 6, name: '鴨賞刈包', price: 95, emoji: '🍔' },
                { id: 7, name: '加蛋', price: 15, emoji: '🥚' },
                { id: 1, name: '冰紅茶', price: 25, emoji: '🥤' },
                { id: 9, name: '冰沙', price: 50, emoji: '🍧' },
                { id: 10, name: '竹炭水', price: 20, emoji: '💧' },
                { id: 11, name: '舒跑', price: 30, emoji: '🥤' },
                { id: 8, name: '炸物', price: 30, emoji: '🍟' }
            ];
            let orderCounter = 1;
            let salesData = {};
            let quantityChartInstance = null;
            let revenueChartInstance = null;

            // --- 元素選取 ---
            const itemsContainer = document.getElementById('items-container');
            const totalPriceEl = document.getElementById('total-price');
            const orderLogBody = document.getElementById('order-log-body');
            const clearLogBtn = document.getElementById('clear-log-btn');
            const quantityChartCtx = document.getElementById('quantityChart').getContext('2d');
            const revenueChartCtx = document.getElementById('revenueChart').getContext('2d');
            const salesSummaryBody = document.getElementById('sales-summary-body');
            const salesSummaryFooter = document.getElementById('sales-summary-footer');

            // --- 函式定義 ---

            function initializeSalesData() {
                salesData = {};
                menuItems.forEach(item => {
                    salesData[item.name] = { quantity: 0, revenue: 0 };
                });
            }

            function renderCharts() {
                const labels = Object.keys(salesData);
                const quantityData = labels.map(label => salesData[label].quantity);
                const revenueData = labels.map(label => salesData[label].revenue);

                if (quantityChartInstance) {
                    quantityChartInstance.destroy();
                }
                quantityChartInstance = new Chart(quantityChartCtx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '銷售數量',
                            data: quantityData,
                            backgroundColor: 'rgba(59, 130, 246, 0.5)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: { scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } }
                });

                if (revenueChartInstance) {
                    revenueChartInstance.destroy();
                }
                revenueChartInstance = new Chart(revenueChartCtx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '銷售金額 (NT$)',
                            data: revenueData,
                            backgroundColor: 'rgba(16, 185, 129, 0.5)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: { scales: { y: { beginAtZero: true } } }
                });
            }

            function renderSalesSummaryTable() {
                salesSummaryBody.innerHTML = '';
                let totalDailyRevenue = 0;

                menuItems.forEach(item => {
                    const itemName = item.name;
                    const data = salesData[itemName];
                    totalDailyRevenue += data.revenue;
                    const rowHTML = `
                        <tr class="hover:bg-gray-50">
                            <td class="py-2 px-4 border-b">${itemName}</td>
                            <td class="py-2 px-4 border-b">${data.quantity}</td>
                            <td class="py-2 px-4 border-b">${data.revenue}</td>
                        </tr>
                    `;
                    salesSummaryBody.insertAdjacentHTML('beforeend', rowHTML);
                });

                // 更新當日總金額
                salesSummaryFooter.innerHTML = `
                    <tr class="bg-gray-100 font-bold">
                        <td class="py-3 px-4" colspan="2">當日總金額</td>
                        <td class="py-3 px-4">${totalDailyRevenue}</td>
                    </tr>
                `;
            }
            
            function renderMenuItems() {
                itemsContainer.innerHTML = '';
                
                menuItems.forEach(itemData => {
                    const itemHTML = `
                        <div class="item relative flex flex-col items-center justify-around bg-white p-2 rounded-lg transition-all duration-200 h-28 cursor-pointer border-2 border-transparent shadow-md hover:shadow-lg" data-id="${itemData.id}" data-price="${itemData.price}" data-name="${itemData.name}">
                            <div class="text-center">
                                <span class="text-3xl">${itemData.emoji}</span>
                                <p class="text-base font-semibold text-gray-800 leading-tight">${itemData.name}</p>
                                <p class="text-base text-gray-500">NT$ ${itemData.price}</p>
                            </div>
                            <div>
                                <span class="quantity text-xl font-semibold text-gray-900 w-8 text-center">0</span>
                            </div>
                            <button class="minus-btn absolute bottom-1.5 right-1.5 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-lg font-bold shadow-md hover:bg-red-600 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-red-400 disabled-btn">-</button>
                        </div>
                    `;
                    itemsContainer.insertAdjacentHTML('beforeend', itemHTML);
                });

                const resetBtnHTML = `
                    <div id="reset-btn" class="flex flex-col items-center justify-center bg-green-500 p-2 rounded-lg transition-all duration-200 h-28 cursor-pointer shadow-md hover:bg-green-600 text-white">
                        <span class="text-3xl">🛒</span>
                        <p class="text-lg font-semibold mt-1 leading-tight">送出訂單</p>
                    </div>
                `;
                itemsContainer.insertAdjacentHTML('beforeend', resetBtnHTML);
            }

            function updateTotal() {
                let currentTotal = 0;
                const items = document.querySelectorAll('.item'); 
                
                items.forEach(item => {
                    const price = parseInt(item.dataset.price);
                    const quantity = parseInt(item.querySelector('.quantity').textContent);
                    const minusBtn = item.querySelector('.minus-btn');
                    currentTotal += price * quantity;

                    if (quantity > 0) {
                        item.classList.add('item-selected');
                        minusBtn.classList.remove('disabled-btn');
                    } else {
                        item.classList.remove('item-selected');
                        minusBtn.classList.add('disabled-btn');
                    }
                });
                
                totalPriceEl.textContent = 'NT$ ' + currentTotal;
                return currentTotal;
            }

            function logOrder() {
                const currentTotal = updateTotal();
                if (currentTotal === 0) {
                    return;
                }

                const items = document.querySelectorAll('.item');
                let itemSummary = [];

                items.forEach(item => {
                    const quantity = parseInt(item.querySelector('.quantity').textContent);
                    if (quantity > 0) {
                        const name = item.dataset.name;
                        const price = parseInt(item.dataset.price);
                        itemSummary.push(`${name} x ${quantity}`);
                        
                        salesData[name].quantity += quantity;
                        salesData[name].revenue += quantity * price;
                    }
                });

                const timestamp = new Date().toLocaleString('zh-TW', { hour12: false });
                const itemDetailsHTML = itemSummary.join('<br>');

                const newRowHTML = `
                    <tr class="hover:bg-gray-50">
                        <td class="py-2 px-4 border-b">${orderCounter}</td>
                        <td class="py-2 px-4 border-b">${itemDetailsHTML}</td>
                        <td class="py-2 px-4 border-b">NT$ ${currentTotal}</td>
                        <td class="py-2 px-4 border-b text-sm text-gray-500">${timestamp}</td>
                    </tr>
                `;

                orderLogBody.insertAdjacentHTML('beforeend', newRowHTML);
                orderCounter++;

                renderCharts();
                renderSalesSummaryTable();

                const allQuantities = document.querySelectorAll('.quantity');
                allQuantities.forEach(quantityEl => {
                    quantityEl.textContent = '0';
                });
                updateTotal();
            }
            
            function setupEventListeners() {
                itemsContainer.addEventListener('click', (e) => {
                    const item = e.target.closest('.item');
                    const minusBtn = e.target.closest('.minus-btn');
                    const resetButton = e.target.closest('#reset-btn');

                    if (resetButton) {
                        logOrder();
                        resetButton.classList.add('btn-press');
                        setTimeout(() => resetButton.classList.remove('btn-press'), 100);
                        return;
                    }

                    if (!item) return;

                    const quantityEl = item.querySelector('.quantity');
                    let quantity = parseInt(quantityEl.textContent);
                    
                    if (minusBtn) {
                        if (quantity > 0) {
                            quantity--;
                        }
                        minusBtn.classList.add('btn-press');
                        setTimeout(() => minusBtn.classList.remove('btn-press'), 100);
                    } 
                    else {
                        quantity++;
                        item.classList.add('btn-press');
                        setTimeout(() => item.classList.remove('btn-press'), 100);
                    }
                    
                    quantityEl.textContent = quantity;
                    updateTotal();
                });

                clearLogBtn.addEventListener('click', () => {
                    orderLogBody.innerHTML = '';
                    orderCounter = 1;
                    initializeSalesData();
                    renderCharts();
                    renderSalesSummaryTable();
                    clearLogBtn.classList.add('btn-press');
                    setTimeout(() => clearLogBtn.classList.remove('btn-press'), 100);
                });
            }

            // --- 初始化 ---
            initializeSalesData();
            renderMenuItems();
            updateTotal();
            renderCharts();
            renderSalesSummaryTable();
            setupEventListeners(); 
        });
    </script>
</body>
</html>
